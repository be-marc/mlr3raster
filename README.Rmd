---
output: github_document
---

```{r, include=FALSE}
lgr::get_logger("mlr3")$set_threshold("warn")
lgr::get_logger("mlr3spatial")$set_threshold("warn")
set.seed(1)
options(datatable.print.class = FALSE, datatable.print.keys = FALSE)
```

# mlr3spatial

Package website: [release](https://mlr3spatial.mlr-org.com/) | [dev](https://mlr3spatial.mlr-org.com/dev/)

mlr3spatial is an extension package for spatial objects within the [mlr3](https://mlr3.mlr-org.com) ecosystem.

## Feature Overview

* Read training data from [sf](https://CRAN.R-project.org/package=sf) objects.
* Predict on raster objects from the packages [terra](https://CRAN.R-project.org/package=terra), [raster](https://CRAN.R-project.org/package=raster) and [stars](https://CRAN.R-project.org/package=stars).
* Write model predictions to raster files.
* Predict large raster objects in parallel.
* Read raster objects in chunks to avoid memory issues.
* Built-in toy tasks [`leipzig`](https://mlr3spatial.mlr-org.com/dev/reference/leipzig.html).

## Installation

Install the last release from CRAN:

```{r, eval=FALSE}
install.packages("mlr3spatial")
```

Install the development version from GitHub:

```{r, eval=FALSE}
remotes::install_github("mlr-org/mlr3spatial")
```

## Example

```{r, include = FALSE}
# mute load messages
library(mlr3)
library(mlr3spatial)
library(terra, exclude = "resample")
library(sf)
```

```{r}
library(mlr3)
library(mlr3spatial)
library(terra, exclude = "resample")
library(sf)

# load sample points
leipzig_vector = read_sf(system.file("extdata", "leipzig_points.gpkg", package = "mlr3spatial"), stringsAsFactors = TRUE)

# create land cover task
task = as_task_classif_st(leipzig_vector, target = "land_cover")
task

# load learner
learner = lrn("classif.rpart")

# train the model
learner$train(task)

# load raster file
leipzig_raster = rast(system.file("extdata", "leipzig_raster.tif", package = "mlr3spatial"))
```

```{r, eval=FALSE}
plotRGB(leipzig_raster, r = 3, g = 2, b = 1, scale = 5451, stretch = "lin")
```

<img src="man/figures/sentinel.png" />

```{r}
# create predict task
task_predict = as_task_unsupervised(leipzig_raster)

# predict land cover map
land_cover = predict_spatial(task_predict, learner)
```

```{r, eval=FALSE}
plot(land_cover, axes = FALSE)
```

<img src="man/figures/land_cover.png" />
